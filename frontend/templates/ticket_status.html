{% extends "base.html" %}
{% block title %}Ticket #{{ ticket.id }} â€” IT Ticket Engine{% endblock %}

{% block content %}
<div class="main-content" style="max-width:700px;">

    <div class="page-header">
        <h1>ğŸ« Ticket #{{ ticket.id }}</h1>
        <p>Full status and resolution details</p>
    </div>

    <!-- STATUS BANNER -->
    {% set s = ticket.status %}
    {% if s == 'Open' %} <div class="alert alert-info mb-2">ğŸ”µ Status: <strong>Open</strong> â€” Waiting for action.</div>
    {% elif s == 'Resolved' %} <div class="alert alert-success mb-2">âœ… Status: <strong>Resolved</strong></div>
    {% elif s == 'Pending' %} <div class="alert alert-warning mb-2">ğŸ• Status: <strong>Pending</strong> â€” Escalated for
        review.</div>
    {% elif s == 'Closed' %} <div class="alert alert-info mb-2">ğŸ”’ Status: <strong>Closed</strong></div>
    {% else %} <div class="alert alert-info mb-2">Status: <strong>{{ s }}</strong></div>
    {% endif %}

    <!-- TICKET DETAILS -->
    <div class="card ticket-detail-card">
        <div class="detail-row">
            <span class="detail-label">Ticket ID</span>
            <span class="detail-value"><strong>#{{ ticket.id }}</strong></span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value">
                {% if s == 'Open' %} <span class="badge badge-open">{{ s }}</span>
                {% elif s == 'Resolved' %} <span class="badge badge-resolved">{{ s }}</span>
                {% elif s == 'Pending' %} <span class="badge badge-pending">{{ s }}</span>
                {% elif s == 'Closed' %} <span class="badge badge-closed">{{ s }}</span>
                {% else %} <span class="badge badge-inprogress">{{ s }}</span>
                {% endif %}
            </span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Category</span>
            <span class="detail-value">{{ ticket.category or 'â€”' }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Priority</span>
            <span class="detail-value">
                {% if ticket.priority == 'High' %} <span class="badge badge-escalated">{{ ticket.priority }}</span>
                {% elif ticket.priority == 'Low' %} <span class="badge badge-resolved">{{ ticket.priority }}</span>
                {% else %} <span class="badge badge-inprogress">{{ ticket.priority }}</span>
                {% endif %}
            </span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Escalated</span>
            <span class="detail-value">
                {% if ticket.escalation_flag %}
                <span class="badge badge-escalated">ğŸ”´ Yes</span>
                {% else %}
                <span class="badge badge-resolved">ğŸŸ¢ No</span>
                {% endif %}
            </span>
        </div>
        {% if ticket.similarity_score %}
        <div class="detail-row">
            <span class="detail-label">AI Score</span>
            <span class="detail-value">
                <span class="score-pill">{{ (ticket.similarity_score * 100) | round(1) }}% match</span>
            </span>
        </div>
        {% endif %}
        <div class="detail-row">
            <span class="detail-label">Description</span>
            <span class="detail-value">{{ ticket.description }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Created</span>
            <span class="detail-value text-muted">{{ ticket.created_at or 'â€”' }}</span>
        </div>
    </div>

    <!-- RESOLUTION -->
    {% if resolution %}
    <div class="card mt-2" style="border-color:rgba(34,197,94,0.3);">
        <h4 class="section-title">âœ… Resolution</h4>
        <div class="resolution-block">
            <div class="block-label">Resolution Text</div>
            {{ resolution.resolution_text }}
        </div>
        {% if resolution.resolved_date %}
        <p class="text-muted mt-1" style="font-size:0.8rem;">Resolved on: {{ resolution.resolved_date[:16] }}</p>
        {% endif %}
    </div>
    {% else %}
    <div class="card mt-2">
        <p class="text-muted">ğŸ“­ No resolution recorded yet.</p>
    </div>
    {% endif %}

    <!-- BACK BUTTON -->
    <div class="mt-3">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">â† Back to Dashboard</a>
    </div>

</div>
{% endblock %}